{
  "meta": {
    "project": "CMP Finance Manager - Svelte Version",
    "date": "2026-01-09",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "CMP Finance Manager is a comprehensive, multi-country financial dashboard designed for managing invoices, payments, collections, clients, and agencies. It supports currency handling for CLP, ARS, and USD, delivering detailed analytics and operational control to financial administrators, account managers, and collection specialists.",
  "core_goals": [
    "Provide secure and reliable user authentication and session management.",
    "Deliver a real-time financial dashboard that displays key metrics and analytics with rich data visualizations.",
    "Enable robust invoice management with advanced filtering, pagination, and inline editing capabilities.",
    "Support comprehensive payment tracking and seamless payment registration workflows.",
    "Facilitate effective collections monitoring with dynamic filters and KPI reporting.",
    "Offer full client and agency management with CRUD operations and email integration.",
    "Allow secure uploading, management, and distribution of related financial files.",
    "Support multi-country and multi-currency operations with context-aware filtering and formatting.",
    "Ensure a responsive, accessible, and user-friendly interface with theme toggling and mobile support."
  ],
  "key_features": [
    "Authentication system with Supabase Auth, Zod form validation, session persistence, and protected routes.",
    "Dashboard displaying KPIs and interactive charts filtered by client, agency, channel, and date range.",
    "Invoice management with searchable, paginated tables, payment status badges, inline editable internal numbers, and payment modals.",
    "Payment history view with search, date filters, and linked invoice details.",
    "Collections management featuring KPI cards and charts to track payment performance and client distribution.",
    "Client and agency CRUD operations with detailed forms, email address management, and relationship assignments.",
    "File management system supporting drag-and-drop uploads, file categorization, filtering, sorting, download, deletion, and emailing functionalities.",
    "Global country selector and currency formatting, including exchange rate integration and persistence.",
    "Responsive layout with a collapsible sidebar, header with navigation, theme toggle, and accessibility features."
  ],
  "user_flow_summary": [
    "User visits login page and authenticates via email/password; successful login redirects to dashboard, failed login shows error.",
    "On dashboard, user applies filters (clients, agencies, channels, date range) to visualize financial KPIs and charts updated in real-time.",
    "From invoice list, user filters invoices, edits internal numbers inline, and opens payment modal to register payments; payment updates invoice status and refreshes list.",
    "User navigates to payments page to search and filter payment records, viewing payment details and associated invoices.",
    "Collections view provides KPIs and charts on payment collections; users filter data by client, agency, and date.",
    "Client management allows users to create, edit, delete clients, manage associated emails, and assign agencies.",
    "Agency management enables adding, editing, and removing agencies with proper handling of relationships.",
    "File management supports uploading files with metadata, browsing, filtering, downloading, deleting, and sending files via email.",
    "Country selector in header changes global context affecting currency display and data filtering, selection persists across sessions.",
    "Users toggle between light and dark mode for preferred theme experience, with system preference detection."
  ],
  "validation_criteria": [
    "User can login/logout successfully with session persistence and protected route enforcement.",
    "Dashboard KPIs and charts reflect accurate, filtered data and respond to global selectors.",
    "Invoice table supports multi-filters, pagination, inline editing, and payment registration with correct status updates.",
    "Payments page search and filters return expected results; payment details modals show linked invoices.",
    "Collections page KPI and charts accurately summarize payment metrics with correct filtering.",
    "Client and agency CRUD operations validate input, save correctly, update UI, and handle relationships properly.",
    "File upload accepts valid files, lists files with accurate metadata, supports download, deletion, and email sending.",
    "Country selection controls currency symbols, exchange rates, and filters all relevant UI data accordingly.",
    "Theme toggle changes visual theme instantly and persists preference.",
    "All routes and components handle loading and error states gracefully with notifications."
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "SvelteKit",
      "Svelte 5",
      "Vite",
      "Supabase",
      "TailwindCSS",
      "Flowbite Svelte",
      "ECharts",
      "AG-Grid",
      "Zod",
      "xlsx",
      "date-fns"
    ],
    "features": [
      {
        "name": "Authentication",
        "description": "User authentication system with login/logout functionality using Supabase Auth. Includes form validation with Zod and session management.",
        "files": [
          "src/routes/login/+page.svelte",
          "src/lib/stores/auth.ts",
          "src/lib/services/supabase.ts"
        ]
      },
      {
        "name": "Dashboard",
        "description": "Main dashboard page showing financial metrics and analytics after user login.",
        "files": [
          "src/routes/dashboard/+page.svelte"
        ]
      },
      {
        "name": "Client Management",
        "description": "CRUD operations for managing clients (clientes). Includes fetching, creating, updating, and deleting clients with associated emails.",
        "files": [
          "src/routes/clientes/+page.svelte",
          "src/lib/stores/clientes.ts",
          "src/lib/types/index.ts"
        ]
      },
      {
        "name": "Agency Management",
        "description": "CRUD operations for managing agencies (agencias). Agencies can be linked to clients.",
        "files": [
          "src/lib/stores/agencias.ts",
          "src/lib/types/index.ts"
        ]
      },
      {
        "name": "Invoice Management",
        "description": "Invoice (facturacion) management with filtering by client, agency, channel, and date. Includes metrics calculation and chart data preparation for visualizations.",
        "files": [
          "src/routes/facturacion/+page.svelte",
          "src/lib/stores/invoices.ts",
          "src/lib/types/index.ts"
        ]
      },
      {
        "name": "Payment Management",
        "description": "Payment (pagos) management with support for multiple invoice allocations. Includes creating and deleting payments with associated payment details.",
        "files": [
          "src/routes/pagos/+page.svelte",
          "src/lib/stores/payments.ts",
          "src/lib/types/index.ts"
        ]
      },
      {
        "name": "Collections (Cobranzas)",
        "description": "Collections management page for tracking payment collections.",
        "files": [
          "src/routes/cobranzas/+page.svelte"
        ]
      },
      {
        "name": "File Management",
        "description": "File upload and management system for storing documents related to clients and invoices.",
        "files": [
          "src/routes/archivos/+page.svelte",
          "src/lib/types/index.ts"
        ]
      },
      {
        "name": "Country Selector",
        "description": "Multi-country support with country selector component. Filters data based on selected country.",
        "files": [
          "src/lib/components/CountrySelector.svelte",
          "src/lib/stores/country.ts"
        ]
      },
      {
        "name": "Theme Toggle",
        "description": "Dark/light theme toggle component for user preference.",
        "files": [
          "src/lib/components/ThemeToggle.svelte"
        ]
      },
      {
        "name": "Currency Formatting",
        "description": "Utility functions for formatting currency values based on country.",
        "files": [
          "src/lib/utils/currency.ts"
        ]
      },
      {
        "name": "Layout and Navigation",
        "description": "Main application layout with navigation and routing.",
        "files": [
          "src/routes/+layout.svelte",
          "src/routes/+page.svelte",
          "src/routes/+error.svelte"
        ]
      }
    ]
  }
}
